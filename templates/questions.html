{% extends "base.html" %}
{% block title %}C√¢u h·ªèi - {{ course['title_vi'] or course['title_en'] }}{% endblock %}
{% block content %}
<a href="{{ url_for('admin_panel') }}#content" class="btn btn-outline btn-sm" style="margin-bottom:16px">‚Üê Quay l·∫°i</a>

<div class="card">
    <h3 style="color:var(--primary);margin-bottom:4px">üìù Qu·∫£n l√Ω c√¢u h·ªèi</h3>
    <p style="color:var(--secondary);font-size:14px;margin-bottom:16px">{{ course['title_vi'] or course['title_en'] }} ‚Äî {{ questions|length }} c√¢u h·ªèi</p>

    <!-- CSV Upload -->
    <div style="background:var(--bg);border-radius:10px;padding:16px;margin-bottom:20px">
        <h4 style="font-size:14px;color:var(--primary);margin-bottom:8px">üìé T·∫£i c√¢u h·ªèi t·ª´ CSV</h4>
        <p style="font-size:12px;color:#888;margin-bottom:8px">
            ƒê·ªãnh d·∫°ng: <code>C√¢u h·ªèi|ƒê√°p √°n A|ƒê√°p √°n B|ƒê√°p √°n C|ƒê√°p √°n D|ƒê√°p √°n ƒë√∫ng (a/b/c/d)|Gi·∫£i th√≠ch</code>
        </p>
        <form method="POST">
            <input type="hidden" name="action" value="csv">
            <textarea name="csv_data" class="form-control" style="font-family:monospace;font-size:12px;min-height:100px" placeholder="C√¢u h·ªèi 1|ƒê√°p √°n A|ƒê√°p √°n B|ƒê√°p √°n C|ƒê√°p √°n D|a|Gi·∫£i th√≠ch&#10;C√¢u h·ªèi 2|ƒê√°p √°n A|ƒê√°p √°n B|ƒê√°p √°n C|ƒê√°p √°n D|b|Gi·∫£i th√≠ch"></textarea>
            <button type="submit" class="btn btn-secondary btn-sm" style="margin-top:8px">üì• Import CSV</button>
        </form>
    </div>

    <!-- Add Manual -->
    <details style="margin-bottom:20px">
        <summary style="cursor:pointer;font-weight:600;color:var(--primary);font-size:14px;padding:8px 0">
            ‚ûï Th√™m c√¢u h·ªèi th·ªß c√¥ng / Add question manually
        </summary>
        <div style="background:var(--bg);border-radius:10px;padding:16px;margin-top:8px">
            <form method="POST">
                <input type="hidden" name="action" value="add">
                <div class="form-group">
                    <label>N·ªôi dung c√¢u h·ªèi *</label>
                    <textarea name="text" class="form-control" required placeholder="Nh·∫≠p c√¢u h·ªèi..."></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ƒê√°p √°n A *</label>
                        <input type="text" name="option_a" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>ƒê√°p √°n B *</label>
                        <input type="text" name="option_b" class="form-control" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ƒê√°p √°n C</label>
                        <input type="text" name="option_c" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>ƒê√°p √°n D</label>
                        <input type="text" name="option_d" class="form-control">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ƒê√°p √°n ƒë√∫ng</label>
                        <select name="answer" class="form-control">
                            <option value="a">A</option>
                            <option value="b">B</option>
                            <option value="c">C</option>
                            <option value="d">D</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Gi·∫£i th√≠ch</label>
                        <input type="text" name="explanation" class="form-control" placeholder="T·∫°i sao ƒë√°p √°n n√†y ƒë√∫ng?">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary btn-sm">üíæ L∆∞u c√¢u h·ªèi</button>
            </form>
        </div>
    </details>

    <!-- Questions List -->
    {% if questions|length == 0 %}
    <p style="text-align:center;color:#888;padding:24px">Ch∆∞a c√≥ c√¢u h·ªèi n√†o. H√£y th√™m c√¢u h·ªèi ·ªü tr√™n.</p>
    {% else %}
    {% for q in questions %}
    <div style="padding:14px 0;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:flex-start;gap:12px">
        <div style="flex:1">
            <p style="font-weight:600;font-size:14px;margin-bottom:6px">{{ loop.index }}. {{ q['text'] }}</p>
            <div style="font-size:12px;color:#666;display:flex;flex-wrap:wrap;gap:12px">
                <span style="{% if q['answer'] == 'a' %}font-weight:700;color:var(--success){% endif %}">A: {{ q['option_a'] }}</span>
                <span style="{% if q['answer'] == 'b' %}font-weight:700;color:var(--success){% endif %}">B: {{ q['option_b'] }}</span>
                {% if q['option_c'] %}<span style="{% if q['answer'] == 'c' %}font-weight:700;color:var(--success){% endif %}">C: {{ q['option_c'] }}</span>{% endif %}
                {% if q['option_d'] %}<span style="{% if q['answer'] == 'd' %}font-weight:700;color:var(--success){% endif %}">D: {{ q['option_d'] }}</span>{% endif %}
            </div>
            {% if q['explanation'] %}<p style="font-size:11px;color:#888;margin-top:4px;font-style:italic">üí° {{ q['explanation'] }}</p>{% endif %}
        </div>
        <form method="POST" onsubmit="return confirm('X√≥a c√¢u h·ªèi n√†y?')">
            <input type="hidden" name="action" value="delete">
            <input type="hidden" name="question_id" value="{{ q['id'] }}">
            <button type="submit" class="btn btn-danger btn-sm">üóë</button>
        </form>
    </div>
    {% endfor %}
    {% endif %}
</div>
{% endblock %}
