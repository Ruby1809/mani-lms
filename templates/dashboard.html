{% extends "base.html" %}
{% block title %}Dashboard - MANI Learning Hub{% endblock %}
{% block content %}
<div class="banner">
    <h2>ChÃ o má»«ng, {{ user['name'] }}! ğŸ‘‹</h2>
    <p>Ná»n táº£ng phÃ¡t triá»ƒn chuyÃªn mÃ´n táº¡i Mani Medical Hanoi</p>
    <div class="banner-stats">
        <div><span>{{ courses|length }}</span><br><span>KhÃ³a há»c</span></div>
        <div><span>{{ passed_ids|length }}</span><br><span>ÄÃ£ hoÃ n thÃ nh</span></div>
        <div><span>{{ courses|length - passed_ids|length }}</span><br><span>Äang chá»</span></div>
    </div>
</div>

{% set pending = [] %}
{% set completed = [] %}
{% for c in courses %}
    {% if c['id'] in passed_ids %}
        {% set _ = completed.append(c) %}
    {% else %}
        {% set _ = pending.append(c) %}
    {% endif %}
{% endfor %}

{% if pending %}
<h3 class="section-title">ğŸ“š KhÃ³a há»c cáº§n hoÃ n thÃ nh ({{ pending|length }})</h3>
<div class="card-grid" style="margin-bottom:32px">
    {% for c in pending %}
    {% set groups = c['target_groups']|default('[]',true) %}
    <a href="{{ url_for('course_detail', cid=c['id']) }}" class="course-card">
        <span class="tag">{{ c['category'] }}</span>
        <h4>{{ c['title_vi'] or c['title_en'] }}</h4>
        <p style="color:#777;font-size:13px;margin:0 0 8px">{{ (c['desc_vi'] or c['desc_en'] or '')[:100] }}{% if (c['desc_vi'] or '')|length > 100 %}...{% endif %}</p>
        <div class="meta">
            <span>ğŸ“ Äiá»ƒm Ä‘áº¡t: {{ c['pass_score'] }}</span>
            {% if c['deadline'] %}
            <span style="color:{% if c['deadline'] < now %}var(--danger){% else %}#888{% endif %}">â° {{ c['deadline'] }}</span>
            {% endif %}
        </div>
    </a>
    {% endfor %}
</div>
{% endif %}

{% if completed %}
<h3 class="section-title" style="color:var(--success)">âœ… ÄÃ£ hoÃ n thÃ nh ({{ completed|length }})</h3>
<div class="card-grid">
    {% for c in completed %}
    <a href="{{ url_for('course_detail', cid=c['id']) }}" class="course-card passed">
        <div style="display:flex;justify-content:space-between;align-items:flex-start">
            <span class="tag">{{ c['category'] }}</span>
            <span class="badge badge-success">âœ“ Äáº¡t</span>
        </div>
        <h4>{{ c['title_vi'] or c['title_en'] }}</h4>
    </a>
    {% endfor %}
</div>
{% endif %}

{% if not courses %}
<div class="card" style="text-align:center;padding:48px;color:#888">
    <p style="font-size:48px">ğŸ“š</p>
    <p>ChÆ°a cÃ³ khÃ³a há»c nÃ o dÃ nh cho báº¡n.</p>
</div>
{% endif %}
{% endblock %}
