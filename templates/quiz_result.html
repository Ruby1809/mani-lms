{% extends "base.html" %}
{% block title %}Káº¿t quáº£ - MANI Learning Hub{% endblock %}
{% block content %}
<a href="{{ url_for('course_detail', cid=course['id']) }}" class="btn btn-outline btn-sm" style="margin-bottom:16px">â† Quay láº¡i khÃ³a há»c</a>

<div class="card" style="text-align:center;padding:40px">
    <div style="font-size:64px;margin-bottom:12px">{% if result['passed'] %}ğŸ‰{% else %}ğŸ˜”{% endif %}</div>
    <h2 style="color:{% if result['passed'] %}var(--success){% else %}var(--danger){% endif %};margin-bottom:8px">
        {% if result['passed'] %}ChÃºc má»«ng! Báº¡n Ä‘Ã£ Ä‘áº¡t!{% else %}ChÆ°a Ä‘áº¡t Ä‘iá»ƒm yÃªu cáº§u{% endif %}
    </h2>
    <p style="font-size:36px;font-weight:700;color:var(--primary);margin:12px 0">{{ result['score'] }}/{{ result['total'] }}</p>
    <p style="color:#666;font-size:14px">Äiá»ƒm Ä‘áº¡t: {{ course['pass_score'] }}/{{ result['total'] }}</p>

    <div style="max-width:300px;margin:16px auto">
        <div class="progress-bar">
            <div class="progress-fill" style="width:{{ (result['score']/result['total']*100)|round }}%;background:{% if result['passed'] %}var(--success){% else %}var(--danger){% endif %}"></div>
        </div>
    </div>

    {% if result['passed'] %}
    <a href="{{ url_for('download_cert', cid=course['id'], rid=result['id']) }}" target="_blank" class="btn btn-primary" style="margin-top:16px;font-size:16px;padding:14px 28px">
        ğŸ“œ Táº£i chá»©ng chá»‰ / Download Certificate
    </a>
    {% else %}
    <a href="{{ url_for('take_quiz', cid=course['id']) }}" class="btn btn-secondary" style="margin-top:16px">
        ğŸ”„ Thá»­ láº¡i / Try Again
    </a>
    {% endif %}
</div>

<!-- Answer Review -->
<h3 class="section-title" style="margin-top:24px">ğŸ“‹ Chi tiáº¿t cÃ¢u tráº£ lá»i</h3>
{% for q in questions %}
{% set user_ans = answers.get(q['id']|string, '') %}
{% set is_correct = user_ans == q['answer'] %}
<div class="card" style="border-left:4px solid {% if is_correct %}var(--success){% else %}var(--danger){% endif %};padding:16px 20px">
    <p style="font-weight:600;font-size:14px;margin-bottom:8px">{{ loop.index }}. {{ q['text'] }}</p>
    <p style="font-size:13px;color:{% if is_correct %}var(--success){% else %}var(--danger){% endif %};margin:4px 0">
        CÃ¢u tráº£ lá»i cá»§a báº¡n:
        {% if user_ans %}
            {% if user_ans == 'a' %}{{ q['option_a'] }}{% elif user_ans == 'b' %}{{ q['option_b'] }}{% elif user_ans == 'c' %}{{ q['option_c'] }}{% else %}{{ q['option_d'] }}{% endif %}
            {% if is_correct %}âœ“{% else %}âœ—{% endif %}
        {% else %}
            (KhÃ´ng tráº£ lá»i) âœ—
        {% endif %}
    </p>
    {% if not is_correct %}
    <p style="font-size:13px;color:var(--success);margin:4px 0">
        ÄÃ¡p Ã¡n Ä‘Ãºng:
        {% if q['answer'] == 'a' %}{{ q['option_a'] }}{% elif q['answer'] == 'b' %}{{ q['option_b'] }}{% elif q['answer'] == 'c' %}{{ q['option_c'] }}{% else %}{{ q['option_d'] }}{% endif %}
    </p>
    {% endif %}
    {% if q['explanation'] %}
    <p style="font-size:12px;color:#888;font-style:italic;margin-top:4px">ğŸ’¡ {{ q['explanation'] }}</p>
    {% endif %}
</div>
{% endfor %}
{% endblock %}
